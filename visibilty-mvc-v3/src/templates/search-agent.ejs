<div class="bg-white rounded-lg shadow-lg p-8">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
        üîç Search Agents
    </h2>
    
    <% if (error) { %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
            <div class="flex items-center">
                <span class="text-red-500 text-xl mr-3">‚ö†Ô∏è</span>
                <div>
                    <h3 class="text-red-800 font-medium">Error</h3>
                    <p class="text-red-700 text-sm"><%= error %></p>
                </div>
            </div>
        </div>
    <% } %>
    
    <form method="GET" action="/search-agent" class="space-y-6">
        <input type="hidden" name="matricule" value="<%= matricule %>">
        <input type="hidden" name="rang" value="<%= rang %>">
        <div>
            <label for="agentSearch" class="block text-sm font-medium text-gray-700 mb-2">
                Agent Search
            </label>
            <input 
                type="text" 
                id="agentSearch" 
                name="query"
                placeholder="Search by matricule or rank..."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
                oninput="searchAgents(this.value)"
                required
            >
            <div id="agentSuggestions" class="mt-2"></div>
        </div>
        
        <button 
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200"
        >
            üîç Search Agents
        </button>
    </form>
</div>

<script>
async function searchAgents(query) {
    if (query.length < 2) {
        document.getElementById('agentSuggestions').innerHTML = '';
        return;
    }

    try {
        const response = await fetch(`/api/agents/search?query=${encodeURIComponent(query)}&currentAgentRang=${encodeURIComponent('<%= rang %>')}&currentAgentMatricule=${encodeURIComponent('<%= matricule %>')}`);
        const data = await response.json();
        
        if (data.success && data.agents.length > 0) {
            const suggestions = data.agents.map(agent => `
                <div 
                    class="p-2 border-b cursor-pointer hover:bg-blue-50"
                    onclick="selectAgent('${agent.matricule}', '${agent.rang}')"
                >
                    ${agent.matricule} - ${agent.rang}
                </div>
            `).join('');
            document.getElementById('agentSuggestions').innerHTML = suggestions;
        } else {
            document.getElementById('agentSuggestions').innerHTML = '<p class="text-gray-500">No agents found</p>';
        }
    } catch (error) {
        console.error('Error searching agents:', error);
        document.getElementById('agentSuggestions').innerHTML = '<p class="text-red-500">Error searching agents</p>';
    }
}

function selectAgent(matricule, rang) {
    document.getElementById('agentSearch').value = matricule;
    document.getElementById('agentSuggestions').innerHTML = '';
}
</script>