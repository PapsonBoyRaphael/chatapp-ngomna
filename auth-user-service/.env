# ========================================================================
# CENADI AUTH-USER SERVICE - CONFIGURATION ENVIRONNEMENT
# Version: 1.0.0
# Description: Variables d'environnement pour le service d'authentification et gestion utilisateurs
# ========================================================================

# ========================================================================
# 1. CONFIGURATION GÉNÉRALE
# ========================================================================

# Environnement d'exécution
NODE_ENV=development
# Options: development, production, test

# Port du service
AUTH_USER_SERVICE_PORT=8001
PORT=8001

# Identifiant unique du serveur
SERVER_ID=auth-user-service-1

# URL publique du service
SERVICE_URL=http://localhost:8001

# ========================================================================
# 2. BASE DE DONNÉES POSTGRESQL
# ========================================================================

# Configuration PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=personnel_db
DB_USER=postgres
DB_PASSWORD=postgres

# Options de connexion PostgreSQL
DB_MAX_CONNECTIONS=20
DB_CONNECTION_TIMEOUT=30000
DB_IDLE_TIMEOUT=10000
DB_ACQUIRE_TIMEOUT=60000

# Pool de connexions
DB_POOL_MIN=0
DB_POOL_MAX=10
DB_POOL_ACQUIRE=30000
DB_POOL_IDLE=10000

# SSL Configuration (Production)
DB_SSL=false
DB_SSL_REJECT_UNAUTHORIZED=false

# ========================================================================
# 3. AUTHENTIFICATION JWT
# ========================================================================

# Secret JWT (⚠️ CHANGER EN PRODUCTION)
JWT_SECRET=CENADI_CHATAPP_UNIFIED_SECRET_2024
JWT_ALGORITHM=HS256
JWT_EXPIRES_IN=24h

# Issuer et audience
JWT_ISSUER=cenadi-auth-service
JWT_AUDIENCE=cenadi-applications

# ========================================================================
# 4. SÉCURITÉ
# ========================================================================

# CORS Configuration
CORS_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8001,http://localhost:8002,http://localhost:8003
CORS_CREDENTIALS=true
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Requested-With

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
# 15 minutes = 15 * 60 * 1000

RATE_LIMIT_MAX_REQUESTS=100
LOGIN_RATE_LIMIT_MAX=20
VALIDATE_RATE_LIMIT_MAX=50
USERS_RATE_LIMIT_MAX=30

# Rate Limit par endpoint
LOGIN_RATE_WINDOW=900000
LOGIN_MAX_ATTEMPTS=10
VALIDATE_RATE_WINDOW=300000
VALIDATE_MAX_REQUESTS=100

# Session et cookies
SESSION_SECRET=CENADI_SESSION_SECRET_2024
SESSION_MAX_AGE=86400000
# 24 heures = 24 * 60 * 60 * 1000

COOKIE_SECURE=false
# true en production avec HTTPS
COOKIE_HTTP_ONLY=true
COOKIE_SAME_SITE=Lax

# Protection CSRF
CSRF_SECRET=CENADI_CSRF_SECRET_2024

# ========================================================================
# 5. SERVICES EXTERNES
# ========================================================================

# Chat-File Service
CHAT_FILE_SERVICE_URL=http://localhost:8003
CHAT_FILE_SERVICE_TIMEOUT=5000

# Service de notifications
NOTIFICATION_SERVICE_URL=http://localhost:8004
NOTIFICATION_SERVICE_TIMEOUT=5000

# Service de médias
MEDIA_SERVICE_URL=http://localhost:8005
MEDIA_SERVICE_TIMEOUT=10000

# URLs de redirection après authentification
DEFAULT_REDIRECT_URL=http://localhost:8003/
SUCCESS_REDIRECT_URL=http://localhost:8003/
ERROR_REDIRECT_URL=http://localhost:8001/

# ========================================================================
# 6. LOGGING ET MONITORING
# ========================================================================

# Configuration logs
LOG_LEVEL=info
# Options: error, warn, info, debug, trace

LOG_DIR=./logs
LOG_MAX_SIZE=10MB
LOG_MAX_FILES=5
LOG_DATE_PATTERN=YYYY-MM-DD

# Fichiers de logs
LOG_ERROR_FILE=error.log
LOG_COMBINED_FILE=combined.log
LOG_ACCESS_FILE=access.log
LOG_AUTH_FILE=auth.log
LOG_DATABASE_FILE=database.log

# Logging base de données
DB_LOGGING=false
# true en développement pour debug SQL

# Monitoring
ENABLE_METRICS=true
METRICS_INTERVAL=60000
# 1 minute = 60 * 1000

HEALTH_CHECK_INTERVAL=30000
# 30 secondes = 30 * 1000

PERFORMANCE_MONITORING=true
ERROR_TRACKING=true

# ========================================================================
# 7. CACHE ET PERFORMANCE
# ========================================================================

# Cache utilisateurs (en mémoire)
ENABLE_USER_CACHE=true
USER_CACHE_TTL=1800
# 30 minutes = 30 * 60

USER_CACHE_MAX_SIZE=1000

# Cache des tokens JWT validés
TOKEN_CACHE_TTL=300
# 5 minutes = 5 * 60

TOKEN_CACHE_MAX_SIZE=500

# Pagination par défaut
DEFAULT_PAGE_SIZE=20
MAX_PAGE_SIZE=100
DEFAULT_USER_LIMIT=50
MAX_USER_LIMIT=200

# Timeout des requêtes
REQUEST_TIMEOUT=30000
# 30 secondes = 30 * 1000

DATABASE_QUERY_TIMEOUT=10000
# 10 secondes = 10 * 1000

# ========================================================================
# 8. VALIDATION ET CONTRAINTES
# ========================================================================

# Validation matricule
MATRICULE_MIN_LENGTH=3
MATRICULE_MAX_LENGTH=20
MATRICULE_PATTERN=^[A-Z0-9]+$

# Validation utilisateur
USER_NAME_MIN_LENGTH=2
USER_NAME_MAX_LENGTH=50
USER_PRENOM_MIN_LENGTH=2
USER_PRENOM_MAX_LENGTH=50

# Limites de requêtes
MAX_USERS_PER_REQUEST=100
MAX_CONCURRENT_LOGINS=10

# ========================================================================
# 9. DÉVELOPPEMENT ET DEBUG
# ========================================================================

# Mode debug
DEBUG_MODE=true
DEBUG_AUTH=true
DEBUG_DATABASE=true
DEBUG_JWT=true
DEBUG_ROUTES=true

# Logging détaillé en développement
VERBOSE_LOGGING=true
SQL_LOGGING=false

# Tests et mock
ENABLE_TEST_ENDPOINTS=true
MOCK_DATABASE=false
TEST_USER_MATRICULE=TEST001

# Fixtures de test
TEST_USERS_COUNT=10
CREATE_TEST_DATA=false

# ========================================================================
# 10. CONNEXIONS EXTERNES
# ========================================================================

# Configuration des timeouts
HTTP_TIMEOUT=10000
# 10 secondes = 10 * 1000

EXTERNAL_SERVICE_TIMEOUT=5000
# 5 secondes = 5 * 1000

RETRY_ATTEMPTS=3
RETRY_DELAY=1000

# Health checks externes
EXTERNAL_HEALTH_CHECK_INTERVAL=60000
# 1 minute = 60 * 1000

EXTERNAL_HEALTH_CHECK_TIMEOUT=5000
# 5 secondes = 5 * 1000

# ========================================================================
# 11. STRUCTURE DE LA BASE DE DONNÉES
# ========================================================================

# Table principale des utilisateurs
PERSONNEL_TABLE=personnel
USER_ID_FIELD=id
USER_AGT_ID_FIELD=agt_id
USER_MATRICULE_FIELD=matricule
USER_NOM_FIELD=nom
USER_PRENOM_FIELD=prenom
USER_SEXE_FIELD=sexe
USER_MM_NAISSANCE_FIELD=mmnaissance
USER_AA_NAISSANCE_FIELD=aanaissance
USER_LIEU_NAISSANCE_FIELD=lieunaissance
USER_MINISTERE_FIELD=ministere

# Colonnes optionnelles
ENABLE_ADDITIONAL_FIELDS=true
USER_EMAIL_FIELD=email
USER_TELEPHONE_FIELD=telephone
USER_SERVICE_FIELD=service
USER_GRADE_FIELD=grade
USER_STATUT_FIELD=statut

# ========================================================================
# 12. SÉCURITÉ AVANCÉE
# ========================================================================

# Protection contre les attaques
ENABLE_BRUTE_FORCE_PROTECTION=true
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=900000
# 15 minutes = 15 * 60 * 1000

LOCKOUT_ESCALATION=true
LOCKOUT_ESCALATION_FACTOR=2

# Validation des entrées
ENABLE_INPUT_SANITIZATION=true
ENABLE_SQL_INJECTION_PROTECTION=true
ENABLE_XSS_PROTECTION=true

# Headers de sécurité
ENABLE_SECURITY_HEADERS=true
ENABLE_HELMET=true
ENABLE_HSTS=false
# true en production HTTPS

# ========================================================================
# 13. AUDIT ET TRAÇABILITÉ
# ========================================================================

# Audit des connexions
ENABLE_LOGIN_AUDIT=true
AUDIT_LOG_FILE=audit.log
AUDIT_RETENTION_DAYS=90

# Traçabilité des actions
TRACK_USER_ACTIONS=true
TRACK_TOKEN_VALIDATION=true
TRACK_API_CALLS=true

# Informations à tracer
TRACK_IP_ADDRESS=true
TRACK_USER_AGENT=true
TRACK_TIMESTAMP=true
TRACK_SESSION_ID=true

# ========================================================================
# 14. BACKUP ET MAINTENANCE
# ========================================================================

# Backup automatique (si applicable)
ENABLE_AUTO_BACKUP=false
BACKUP_INTERVAL=86400000
# 24 heures = 24 * 60 * 60 * 1000

BACKUP_RETENTION_DAYS=30
BACKUP_PATH=./backup

# Maintenance de la base
ENABLE_AUTO_VACUUM=true
VACUUM_INTERVAL=604800000
# 1 semaine = 7 * 24 * 60 * 60 * 1000

# Nettoyage des logs
AUTO_CLEANUP_LOGS=true
LOG_RETENTION_DAYS=30
CLEANUP_INTERVAL=86400000
# 24 heures = 24 * 60 * 60 * 1000

# ========================================================================
# 15. PERFORMANCE ET OPTIMISATION
# ========================================================================

# Pool de connexions optimisé
DB_POOL_EVICT=10000
DB_POOL_VALIDATE=true
DB_POOL_HANDLE_DISCONNECTS=true

# Cache de requêtes
ENABLE_QUERY_CACHE=true
QUERY_CACHE_SIZE=100
QUERY_CACHE_TTL=300
# 5 minutes = 5 * 60

# Compression des réponses
ENABLE_COMPRESSION=true
COMPRESSION_THRESHOLD=1024

# Keep-alive
ENABLE_KEEP_ALIVE=true
KEEP_ALIVE_TIMEOUT=65000

# ========================================================================
# 16. INTÉGRATION AVEC D'AUTRES SERVICES
# ========================================================================

# Communication inter-services
SERVICE_DISCOVERY_URL=
SERVICE_REGISTRY_URL=

# Headers d'authentification inter-services
INTER_SERVICE_SECRET=CENADI_INTER_SERVICE_SECRET_2024
INTER_SERVICE_TOKEN_HEADER=X-Service-Token

# Webhooks pour notifications
WEBHOOK_USER_LOGIN=
WEBHOOK_USER_LOGOUT=
WEBHOOK_TOKEN_VALIDATION=

# ========================================================================
# 17. FEATURES FLAGS
# ========================================================================

# Fonctionnalités activées/désactivées
FEATURE_USER_LISTING=true
FEATURE_USER_DETAILS=true
FEATURE_TOKEN_VALIDATION=true
FEATURE_REFRESH_TOKENS=false
FEATURE_PASSWORD_AUTHENTICATION=false
# Actuellement, seule l'auth par matricule est supportée

FEATURE_USER_REGISTRATION=false
FEATURE_PASSWORD_RESET=false
FEATURE_EMAIL_VERIFICATION=false
FEATURE_TWO_FACTOR_AUTH=false

# Fonctionnalités administratives
FEATURE_USER_MANAGEMENT=false
FEATURE_ROLE_MANAGEMENT=false
FEATURE_PERMISSION_MANAGEMENT=false

# ========================================================================
# 18. CONFIGURATION PRODUCTION
# ========================================================================

# SSL/TLS (Production uniquement)
SSL_ENABLED=false
SSL_CERT_PATH=
SSL_KEY_PATH=
SSL_CA_PATH=

# Variables d'environnement production
PRODUCTION_DB_HOST=
PRODUCTION_DB_NAME=
PRODUCTION_DB_USER=
PRODUCTION_DB_PASSWORD=

# Load balancing
CLUSTER_MODE=false
CLUSTER_INSTANCES=1

# Monitoring externe (Production)
EXTERNAL_MONITORING_URL=
MONITORING_API_KEY=
ERROR_REPORTING_URL=
ERROR_REPORTING_API_KEY=

# ========================================================================
# 19. MÉTRIQUES ET ANALYTICS
# ========================================================================

# Collecte de métriques
COLLECT_METRICS=true
METRICS_ENDPOINT=/metrics
METRICS_AUTH_REQUIRED=false

# Métriques personnalisées
TRACK_LOGIN_COUNT=true
TRACK_VALIDATION_COUNT=true
TRACK_USER_QUERIES=true
TRACK_RESPONSE_TIMES=true

# Envoi vers systèmes externes
METRICS_EXPORT_ENABLED=false
METRICS_EXPORT_URL=
METRICS_EXPORT_INTERVAL=60000

# ========================================================================
# 20. CONFIGURATION RÉSEAU
# ========================================================================

# Configuration serveur
HOST=0.0.0.0
MAX_CONNECTIONS=1000
REQUEST_SIZE_LIMIT=1mb

# Timeouts
SERVER_TIMEOUT=30000
KEEP_ALIVE_TIMEOUT=5000
HEADERS_TIMEOUT=60000

# Proxy et load balancer
TRUST_PROXY=false
# true si derrière un proxy/load balancer

PROXY_COUNT=0
# Nombre de proxies de confiance

# ========================================================================
# FIN DE CONFIGURATION
# ========================================================================