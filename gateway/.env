# ========================================================================
# CENADI GATEWAY - CONFIGURATION ENVIRONNEMENT
# Version: 1.0.0
# Description: Gateway principal pour l'écosystème CENADI microservices
# ========================================================================

# ========================================================================
# 1. CONFIGURATION GÉNÉRALE
# ========================================================================

# Environnement d'exécution
NODE_ENV=development
# Options: development, production, test

# Port de la gateway
GATEWAY_PORT=8000
PORT=8000

# Informations du serveur
SERVER_ID=cenadi-gateway-1
GATEWAY_NAME=CENADI Gateway

# URLs publiques
GATEWAY_URL=http://localhost:8000
PUBLIC_URL=http://localhost:8000

# ========================================================================
# 2. SERVICES MICROSERVICES
# ========================================================================

# Service d'authentification et utilisateurs (Port 8001)
AUTH_USER_SERVICE_URL=http://localhost:8001
AUTH_USER_SERVICE_NAME=Auth-User Service
AUTH_USER_SERVICE_TIMEOUT=30000

# Service de visibilité et groupes (Port 8002)
VISIBILITY_SERVICE_URL=http://localhost:8002
VISIBILITY_SERVICE_NAME=Visibility Service
VISIBILITY_SERVICE_TIMEOUT=30000

# Service de chat et fichiers (Port 8003)
CHAT_FILE_SERVICE_URL=http://localhost:8003
CHAT_FILE_SERVICE_NAME=Chat-File Service
CHAT_FILE_SERVICE_TIMEOUT=30000

# Service de notifications (Port 8004)
NOTIFICATION_SERVICE_URL=http://localhost:8004
NOTIFICATION_SERVICE_NAME=Notification Service
NOTIFICATION_SERVICE_TIMEOUT=30000

# Service de médias (Port 8005)
MEDIA_SERVICE_URL=http://localhost:8005
MEDIA_SERVICE_NAME=Media Service
MEDIA_SERVICE_TIMEOUT=30000

# ========================================================================
# 3. CONFIGURATION PROXY
# ========================================================================

# Options proxy HTTP
PROXY_TIMEOUT=30000
PROXY_SECURE=false
PROXY_CHANGE_ORIGIN=true
PROXY_XFwd=true

# Headers proxy
PROXY_SET_HOST=true
PROXY_PRESERVE_HOST_HDR=false
PROXY_FOLLOW_REDIRECTS=false

# Retry et circuit breaker
PROXY_RETRY_ATTEMPTS=3
PROXY_RETRY_DELAY=1000
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60000

# ========================================================================
# 4. SÉCURITÉ
# ========================================================================

# CORS Configuration
CORS_ENABLED=true
CORS_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8001,http://localhost:8002,http://localhost:8003,http://localhost:8004,http://localhost:8005
CORS_CREDENTIALS=true
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Requested-With,X-Gateway-Time,X-Forwarded-For
CORS_EXPOSED_HEADERS=X-Total-Count,X-Page-Count,X-Current-Page

# Rate Limiting Global
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000
# 15 minutes = 15 * 60 * 1000

RATE_LIMIT_MAX_REQUESTS=1000
RATE_LIMIT_MESSAGE=Trop de requêtes, veuillez patienter
RATE_LIMIT_RETRY_AFTER=15 minutes

# Rate Limiting par service
# Authentification (plus strict)
AUTH_RATE_LIMIT_WINDOW=900000
AUTH_RATE_LIMIT_MAX=10
AUTH_RATE_LIMIT_MESSAGE=Trop de tentatives de connexion, compte temporairement bloqué

# API générale
API_RATE_LIMIT_WINDOW=900000
API_RATE_LIMIT_MAX=500

# Upload de fichiers
UPLOAD_RATE_LIMIT_WINDOW=900000
UPLOAD_RATE_LIMIT_MAX=50

# Messages (chat)
MESSAGE_RATE_LIMIT_WINDOW=300000
MESSAGE_RATE_LIMIT_MAX=200

# Rate limiting par IP
IP_WHITELIST=127.0.0.1,::1,localhost
IP_BLACKLIST=

# Helmet Security Headers
HELMET_ENABLED=true
HELMET_CSP_ENABLED=false
# Désactivé en développement
HELMET_HSTS_ENABLED=false
# Activé uniquement en production HTTPS
HELMET_FRAME_GUARD=deny
HELMET_X_DOWNLOAD_OPTIONS=noopen

# ========================================================================
# 5. COMPRESSION ET PERFORMANCE
# ========================================================================

# Compression des réponses
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6
COMPRESSION_THRESHOLD=1024
COMPRESSION_FILTER_MULTIPART=true

# Cache des fichiers statiques
STATIC_CACHE_MAX_AGE=86400000
# 1 jour = 24 * 60 * 60 * 1000

STATIC_ETAG_ENABLED=true
STATIC_LAST_MODIFIED=true

# Limites de taille des requêtes
REQUEST_SIZE_LIMIT=50mb
JSON_LIMIT=10mb
URL_ENCODED_LIMIT=10mb

# Keep-alive
KEEP_ALIVE_ENABLED=true
KEEP_ALIVE_TIMEOUT=65000

# ========================================================================
# 6. LOGGING ET MONITORING
# ========================================================================

# Configuration logging
LOG_LEVEL=info
# Options: error, warn, info, debug, trace

LOG_ENABLED=true
LOG_REQUESTS=true
LOG_RESPONSES=true
LOG_PROXY_REQUESTS=true
LOG_PROXY_RESPONSES=true

# Fichiers de logs
LOG_DIR=./logs
LOG_FILE=gateway.log
LOG_ERROR_FILE=gateway-error.log
LOG_ACCESS_FILE=gateway-access.log
LOG_PROXY_FILE=gateway-proxy.log

# Rotation des logs
LOG_MAX_SIZE=10MB
LOG_MAX_FILES=5
LOG_DATE_PATTERN=YYYY-MM-DD

# Couleurs dans les logs (développement)
LOG_COLORS_ENABLED=true
LOG_TIMESTAMP=true

# Monitoring et métriques
MONITORING_ENABLED=true
METRICS_ENABLED=true
METRICS_ENDPOINT=/metrics
METRICS_INTERVAL=60000

# Health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_ENDPOINT=/api/health
HEALTH_CHECK_INTERVAL=30000

# ========================================================================
# 7. FRONTEND ET STATIQUES
# ========================================================================

# Configuration frontend
FRONTEND_URL=http://localhost:3000
FRONTEND_BUILD_PATH=./public
SERVE_STATIC_FILES=true

# Favicon et assets
FAVICON_ENABLED=true
FAVICON_PATH=./public/favicon.ico

# SPA (Single Page Application) support
SPA_MODE=false
SPA_INDEX_FILE=index.html

# ========================================================================
# 8. LOAD BALANCING ET CLUSTERING
# ========================================================================

# Load balancing
LOAD_BALANCING_ENABLED=false
LOAD_BALANCING_STRATEGY=round-robin
# Options: round-robin, least-connections, ip-hash

# Clustering
CLUSTER_MODE=false
CLUSTER_WORKERS=0
# 0 = auto (nombre de CPUs)

# Session affinity
STICKY_SESSIONS=false
SESSION_COOKIE_NAME=cenadi-session

# ========================================================================
# 9. WEBSOCKET ET TEMPS RÉEL
# ========================================================================

# WebSocket proxy
WEBSOCKET_ENABLED=true
WEBSOCKET_PROXY_TIMEOUT=300000
# 5 minutes = 5 * 60 * 1000

WEBSOCKET_UPGRADE_TIMEOUT=10000
WEBSOCKET_PING_INTERVAL=25000
WEBSOCKET_PING_TIMEOUT=60000

# Support WebSocket pour chaque service
CHAT_WEBSOCKET_ENABLED=true
NOTIFICATION_WEBSOCKET_ENABLED=true

# ========================================================================
# 10. CACHE ET PERFORMANCES
# ========================================================================

# Cache Redis (optionnel)
REDIS_CACHE_ENABLED=false
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=1
REDIS_PASSWORD=

# Cache in-memory
MEMORY_CACHE_ENABLED=true
MEMORY_CACHE_MAX_SIZE=100
MEMORY_CACHE_TTL=300
# 5 minutes = 5 * 60

# Cache des routes
ROUTE_CACHE_ENABLED=false
ROUTE_CACHE_TTL=60

# ========================================================================
# 11. VALIDATION ET TRANSFORMATION
# ========================================================================

# Validation des requêtes
REQUEST_VALIDATION_ENABLED=true
VALIDATE_HEADERS=true
VALIDATE_QUERY_PARAMS=true
VALIDATE_BODY=true

# Transformation des requêtes
TRANSFORM_REQUESTS=true
ADD_GATEWAY_HEADERS=true
ADD_TIMESTAMP_HEADER=true
ADD_REQUEST_ID=true

# Headers ajoutés automatiquement
GATEWAY_HEADER_NAME=X-Gateway
GATEWAY_HEADER_VALUE=CENADI-Gateway/1.0
TIMESTAMP_HEADER_NAME=X-Gateway-Time
REQUEST_ID_HEADER_NAME=X-Request-ID

# ========================================================================
# 12. DÉVELOPPEMENT ET DEBUG
# ========================================================================

# Mode debug
DEBUG_MODE=true
DEBUG_PROXY=true
DEBUG_ROUTING=true
DEBUG_HEADERS=true
DEBUG_PERFORMANCE=true

# Logging détaillé en développement
VERBOSE_LOGGING=true
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false

# Tests et endpoints de debug
ENABLE_DEBUG_ENDPOINTS=true
DEBUG_INFO_ENDPOINT=/debug/info
DEBUG_ROUTES_ENDPOINT=/debug/routes
DEBUG_SERVICES_ENDPOINT=/debug/services

# ========================================================================
# 13. ROUTES ET ENDPOINTS
# ========================================================================

# Configuration des routes
ROUTES_CONFIG_FILE=
ROUTES_AUTO_DISCOVERY=false

# Préfixes des routes
API_PREFIX=/api
AUTH_ROUTE_PREFIX=/api/auth
USERS_ROUTE_PREFIX=/api/users
GROUPS_ROUTE_PREFIX=/api/groups
VISIBILITY_ROUTE_PREFIX=/api/visibility
MESSAGES_ROUTE_PREFIX=/api/messages
CONVERSATIONS_ROUTE_PREFIX=/api/conversations
FILES_ROUTE_PREFIX=/api/files

# Redirections
DEFAULT_REDIRECT_URL=/
AUTH_SUCCESS_REDIRECT=/dashboard
AUTH_ERROR_REDIRECT=/login

# ========================================================================
# 14. SÉCURITÉ AVANCÉE
# ========================================================================

# Protection DDOS
DDOS_PROTECTION_ENABLED=true
DDOS_BURST=100
DDOS_LIMIT=1000
DDOS_MAX_COUNT=300

# Authentification inter-services
INTER_SERVICE_AUTH_ENABLED=false
INTER_SERVICE_SECRET=CENADI_GATEWAY_INTER_SERVICE_SECRET_2024

# Headers de sécurité personnalisés
CUSTOM_SECURITY_HEADERS=true
REMOVE_POWERED_BY=true
HIDE_SERVER_INFO=true

# Validation SSL en production
SSL_VALIDATION_ENABLED=false
SSL_CERT_PATH=
SSL_KEY_PATH=

# ========================================================================
# 15. MONITORING EXTERNE
# ========================================================================

# Services de monitoring
EXTERNAL_MONITORING_ENABLED=false
MONITORING_SERVICE_URL=
MONITORING_API_KEY=

# Alertes
ALERTS_ENABLED=false
ALERT_EMAIL=admin@cenadi.com
ALERT_WEBHOOK_URL=

# APM (Application Performance Monitoring)
APM_ENABLED=false
APM_SERVICE_NAME=cenadi-gateway
APM_SERVICE_VERSION=1.0.0

# ========================================================================
# 16. BACKUP ET RÉCUPÉRATION
# ========================================================================

# Backup des configurations
BACKUP_ENABLED=false
BACKUP_INTERVAL=86400000
# 24 heures = 24 * 60 * 60 * 1000

BACKUP_RETENTION_DAYS=7
BACKUP_PATH=./backup

# Sauvegarde des logs
LOG_BACKUP_ENABLED=true
LOG_BACKUP_RETENTION_DAYS=30

# ========================================================================
# 17. FEATURES FLAGS
# ========================================================================

# Fonctionnalités activées/désactivées
FEATURE_PROXY_CACHING=false
FEATURE_REQUEST_TRANSFORMATION=true
FEATURE_RESPONSE_TRANSFORMATION=false
FEATURE_AUTO_RETRY=true
FEATURE_CIRCUIT_BREAKER=true
FEATURE_LOAD_BALANCING=false
FEATURE_A_B_TESTING=false
FEATURE_CANARY_DEPLOYMENT=false

# Fonctionnalités de développement
FEATURE_HOT_RELOAD=true
FEATURE_DEBUG_PANEL=true
FEATURE_MOCK_RESPONSES=false

# ========================================================================
# 18. PERFORMANCE ET LIMITES
# ========================================================================

# Limites de connexions
MAX_CONNECTIONS=1000
MAX_CONNECTIONS_PER_IP=50

# Timeouts
REQUEST_TIMEOUT=30000
RESPONSE_TIMEOUT=30000
CONNECT_TIMEOUT=10000

# Pool de connexions
CONNECTION_POOL_SIZE=50
CONNECTION_POOL_MAX_IDLE=10

# Mémoire et CPU
MEMORY_LIMIT=512MB
CPU_LIMIT=2

# ========================================================================
# 19. CONFIGURATION PRODUCTION
# ========================================================================

# Variables production
PRODUCTION_MODE=false
PRODUCTION_HOST=0.0.0.0
PRODUCTION_PORT=80

# SSL en production
PRODUCTION_SSL_ENABLED=false
PRODUCTION_SSL_PORT=443
PRODUCTION_FORCE_HTTPS=false

# Domaines autorisés en production
PRODUCTION_ALLOWED_HOSTS=cenadi.com,*.cenadi.com
PRODUCTION_CORS_ORIGINS=https://app.cenadi.com,https://admin.cenadi.com

# ========================================================================
# 20. CONFIGURATION RÉSEAU
# ========================================================================

# Configuration serveur
HOST=0.0.0.0
SERVER_NAME=cenadi-gateway

# Proxy settings
TRUST_PROXY=false
PROXY_HOPS=1

# IPv6 support
IPV6_ENABLED=true
IPV6_ONLY=false

# DNS
DNS_TIMEOUT=5000
DNS_RETRIES=3

# ========================================================================
# FIN DE CONFIGURATION
# ========================================================================