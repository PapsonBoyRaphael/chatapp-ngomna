# ========================================================================
# CENADI CHAT-FILE SERVICE - CONFIGURATION ENVIRONNEMENT
# Version: 1.0.0
# Description: Variables d'environnement pour le service de chat et fichiers
# ========================================================================

# ========================================================================
# 1. CONFIGURATION GÉNÉRALE
# ========================================================================

# Environnement d'exécution
NODE_ENV=development
# Options: development, production, test

# Port du service
PORT=8003
CHAT_FILE_SERVICE_PORT=8003

# Identifiant unique du serveur (pour le scaling)
SERVER_ID=chat-file-service-1

# Secret JWT pour l'authentification
JWT_SECRET=CENADI_CHATAPP_UNIFIED_SECRET_2024
JWT_ALGORITHM=HS256
# ⚠️ CHANGER EN PRODUCTION avec une clé complexe

# Clé de chiffrement pour les fichiers sensibles
ENCRYPTION_KEY=CENADI_FILE_ENCRYPTION_KEY_2024

# ========================================================================
# 2. BASE DE DONNÉES MONGODB
# ========================================================================

# URI de connexion MongoDB
MONGODB_URI=mongodb://localhost:27017/cenadi_chat_file_db

# Options de connexion MongoDB
MONGODB_MAX_CONNECTIONS=10
MONGODB_CONNECTION_TIMEOUT=30000
MONGODB_SOCKET_TIMEOUT=45000
MONGODB_BUFFER_MAX_ENTRIES=0

# Base de données par défaut
MONGODB_DB_NAME=cenadi_chat_file_db

# Collections
MONGODB_MESSAGES_COLLECTION=messages
MONGODB_CONVERSATIONS_COLLECTION=conversations
MONGODB_FILES_COLLECTION=files
MONGODB_USERS_COLLECTION=users

# ========================================================================
# 3. REDIS (CACHE ET SESSIONS)
# ========================================================================

# Activation Redis
ENABLE_REDIS=true

# Configuration Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_FAMILY=4

# Options avancées Redis
REDIS_KEEP_ALIVE=true
REDIS_CONNECTION_TIMEOUT=5000
REDIS_MAX_RETRY_ATTEMPTS=3
REDIS_RETRY_DELAY=1000

# TTL par défaut (en secondes)
REDIS_DEFAULT_TTL=3600
REDIS_SESSION_TTL=86400
REDIS_CACHE_TTL=1800

# Préfixes Redis
REDIS_PREFIX=cenadi:chat:
REDIS_ONLINE_USERS_KEY=online_users
REDIS_ROOMS_KEY=rooms
REDIS_CACHE_PREFIX=cache:

# ========================================================================
# 4. KAFKA (ÉVÉNEMENTS TEMPS RÉEL)
# ========================================================================

# Activation Kafka
ENABLE_KAFKA=true

# Configuration Kafka
KAFKA_BROKERS=localhost:9092
KAFKA_CLIENT_ID=cenadi-chat-file-service
KAFKA_GROUP_ID=cenadi-chat-file-group

# Topics Kafka
KAFKA_MESSAGES_TOPIC=chat.messages
KAFKA_FILES_TOPIC=chat.files
KAFKA_NOTIFICATIONS_TOPIC=chat.notifications
KAFKA_EVENTS_TOPIC=chat.events
KAFKA_USER_ACTIVITY_TOPIC=chat.user.activity

# Options Kafka Producer
KAFKA_PRODUCER_BATCH_SIZE=16384
KAFKA_PRODUCER_LINGER_MS=10
KAFKA_PRODUCER_COMPRESSION_TYPE=gzip
KAFKA_PRODUCER_MAX_IN_FLIGHT_REQUESTS=5

# Options Kafka Consumer
KAFKA_CONSUMER_SESSION_TIMEOUT=30000
KAFKA_CONSUMER_HEARTBEAT_INTERVAL=3000
KAFKA_CONSUMER_AUTO_OFFSET_RESET=latest
KAFKA_CONSUMER_ENABLE_AUTO_COMMIT=true

# Retry et timeout
KAFKA_CONNECTION_TIMEOUT=10000
KAFKA_REQUEST_TIMEOUT=30000
KAFKA_RETRY_ATTEMPTS=5
KAFKA_RETRY_DELAY=1000

# ========================================================================
# 5. STOCKAGE ET FICHIERS
# ========================================================================

# Répertoires de stockage
STORAGE_BASE_PATH=./storage
STORAGE_UPLOAD_PATH=./storage/uploads
STORAGE_TEMP_PATH=./storage/temp
STORAGE_BACKUP_PATH=./storage/backup

# Tailles maximales
MAX_FILE_SIZE=10485760
# 10MB = 10 * 1024 * 1024 bytes

MAX_FILES_PER_UPLOAD=5
MAX_TOTAL_UPLOAD_SIZE=52428800
# 50MB = 50 * 1024 * 1024 bytes

# Types de fichiers autorisés
ALLOWED_FILE_TYPES=jpeg,jpg,png,gif,pdf,doc,docx,txt,mp4,avi,mov,mp3,wav,zip,rar
ALLOWED_IMAGE_TYPES=jpeg,jpg,png,gif,webp
ALLOWED_DOCUMENT_TYPES=pdf,doc,docx,txt,xlsx,pptx
ALLOWED_VIDEO_TYPES=mp4,avi,mov,wmv,flv
ALLOWED_AUDIO_TYPES=mp3,wav,aac,ogg

# Configuration images
IMAGE_THUMBNAIL_WIDTH=200
IMAGE_THUMBNAIL_HEIGHT=200
IMAGE_THUMBNAIL_QUALITY=80
IMAGE_MAX_WIDTH=1920
IMAGE_MAX_HEIGHT=1080

# Compression
ENABLE_FILE_COMPRESSION=true
COMPRESSION_THRESHOLD=1048576
# 1MB = 1024 * 1024 bytes

# ========================================================================
# 6. SÉCURITÉ
# ========================================================================

# CORS
CORS_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8001,http://localhost:8002,http://localhost:8003
CORS_CREDENTIALS=true

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
# 15 minutes = 15 * 60 * 1000

RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_MAX_FILE_UPLOADS=10
RATE_LIMIT_MAX_MESSAGES=50

# API Rate Limits
API_RATE_LIMIT_WINDOW=900000
API_RATE_LIMIT_MAX=100
FILE_RATE_LIMIT_MAX=10
MESSAGE_RATE_LIMIT_MAX=50
HEALTH_RATE_LIMIT_MAX=20

# Session
SESSION_SECRET=CENADI_SESSION_SECRET_2024
SESSION_MAX_AGE=86400000
# 24 heures = 24 * 60 * 60 * 1000

# Chiffrement des fichiers sensibles
ENABLE_FILE_ENCRYPTION=false
FILE_ENCRYPTION_ALGORITHM=aes-256-gcm

# ========================================================================
# 7. SERVICES EXTERNES
# ========================================================================

# Service d'authentification/utilisateurs
AUTH_SERVICE_URL=http://localhost:8000
USER_SERVICE_URL=http://localhost:8000/api/users
USER_SERVICE_TIMEOUT=5000

# Service de notifications
NOTIFICATION_SERVICE_URL=http://localhost:8004
NOTIFICATION_SERVICE_TIMEOUT=5000

# Service de médias
MEDIA_SERVICE_URL=http://localhost:8005
MEDIA_SERVICE_TIMEOUT=10000

# URLs publiques
PUBLIC_FILE_URL=http://localhost:8003/files
PUBLIC_THUMBNAIL_URL=http://localhost:8003/thumbnails

# ========================================================================
# 8. WEBSOCKET
# ========================================================================

# Configuration Socket.IO
WEBSOCKET_ENABLED=true
WEBSOCKET_CORS_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8001,http://localhost:8002,http://localhost:8003
WEBSOCKET_PING_TIMEOUT=60000
WEBSOCKET_PING_INTERVAL=25000

# Limites WebSocket
MAX_WEBSOCKET_CONNECTIONS=1000
MAX_ROOMS_PER_USER=50
MAX_USERS_PER_ROOM=100

# Timeout et retry
WEBSOCKET_CONNECTION_TIMEOUT=20000
WEBSOCKET_HANDSHAKE_TIMEOUT=10000
WEBSOCKET_HEARTBEAT_INTERVAL=30000

# ========================================================================
# 9. LOGGING ET MONITORING
# ========================================================================

# Configuration logs
LOG_LEVEL=info
# Options: error, warn, info, debug, trace

LOG_DIR=./logs
LOG_MAX_SIZE=10MB
LOG_MAX_FILES=5
LOG_DATE_PATTERN=YYYY-MM-DD

# Fichiers de logs
LOG_ERROR_FILE=error.log
LOG_COMBINED_FILE=combined.log
LOG_ACCESS_FILE=access.log
LOG_KAFKA_FILE=kafka.log
LOG_REDIS_FILE=redis.log

# Monitoring
ENABLE_METRICS=true
METRICS_INTERVAL=60000
# 1 minute = 60 * 1000

HEALTH_CHECK_INTERVAL=30000
# 30 secondes = 30 * 1000

PERFORMANCE_MONITORING=true
ERROR_TRACKING=true

# ========================================================================
# 10. CACHE ET PERFORMANCE
# ========================================================================

# Cache TTL (Time To Live) en secondes
CACHE_MESSAGES_TTL=3600
# 1 heure

CACHE_CONVERSATIONS_TTL=7200
# 2 heures

CACHE_FILES_TTL=86400
# 24 heures

CACHE_USERS_TTL=1800
# 30 minutes

# Pagination par défaut
DEFAULT_PAGE_SIZE=20
MAX_PAGE_SIZE=100
DEFAULT_MESSAGE_LIMIT=50
MAX_MESSAGE_LIMIT=200

# Pool de connexions
DB_CONNECTION_POOL_SIZE=10
REDIS_CONNECTION_POOL_SIZE=5

# ========================================================================
# 11. DÉVELOPPEMENT ET DEBUG
# ========================================================================

# Mode debug
DEBUG_MODE=true
DEBUG_WEBSOCKET=true
DEBUG_KAFKA=true
DEBUG_REDIS=true
DEBUG_DATABASE=true

# Tests
ENABLE_TEST_ENDPOINTS=true
TEST_USER_ID=test-user-123
TEST_CONVERSATION_ID=test-conversation-456

# Mock services en développement
MOCK_AUTH_SERVICE=false
MOCK_NOTIFICATION_SERVICE=false
MOCK_USER_SERVICE=false

# ========================================================================
# 12. BACKUP ET RÉCUPÉRATION
# ========================================================================

# Configuration backup
ENABLE_AUTO_BACKUP=false
BACKUP_INTERVAL=86400000
# 24 heures = 24 * 60 * 60 * 1000

BACKUP_RETENTION_DAYS=7
BACKUP_COMPRESSION=true

# Répertoires backup
BACKUP_DB_PATH=./backup/database
BACKUP_FILES_PATH=./backup/files
BACKUP_LOGS_PATH=./backup/logs

# ========================================================================
# 13. NOTIFICATIONS
# ========================================================================

# Email notifications
ENABLE_EMAIL_NOTIFICATIONS=false
SMTP_HOST=localhost
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=noreply@cenadi.com

# Push notifications
ENABLE_PUSH_NOTIFICATIONS=false
FCM_SERVER_KEY=
FCM_SENDER_ID=

# Webhooks
ENABLE_WEBHOOKS=false
WEBHOOK_SECRET=CENADI_WEBHOOK_SECRET_2024

# ========================================================================
# 14. LIMITES ET QUOTAS
# ========================================================================

# Limites par utilisateur
MAX_FILES_PER_USER=1000
MAX_CONVERSATIONS_PER_USER=100
MAX_MESSAGES_PER_DAY=10000
MAX_STORAGE_PER_USER=1073741824
# 1GB = 1024 * 1024 * 1024 bytes

# Limites système
MAX_CONCURRENT_UPLOADS=10
MAX_CONCURRENT_DOWNLOADS=50
MAX_PROCESSING_QUEUE=100

# Nettoyage automatique
AUTO_CLEANUP_ENABLED=true
CLEANUP_TEMP_FILES_AFTER=3600000
# 1 heure = 60 * 60 * 1000

CLEANUP_OLD_LOGS_AFTER=2592000000
# 30 jours = 30 * 24 * 60 * 60 * 1000

# ========================================================================
# 15. FEATURES FLAGS
# ========================================================================

# Fonctionnalités activées/désactivées
FEATURE_FILE_SHARING=true
FEATURE_IMAGE_PROCESSING=true
FEATURE_VIDEO_PROCESSING=false
FEATURE_AUDIO_PROCESSING=false
FEATURE_DOCUMENT_PREVIEW=true
FEATURE_REAL_TIME_TYPING=true
FEATURE_MESSAGE_ENCRYPTION=false
FEATURE_FILE_VERSIONING=false
FEATURE_CONVERSATION_ARCHIVE=true
FEATURE_USER_PRESENCE=true
FEATURE_MESSAGE_REACTIONS=false
FEATURE_FILE_THUMBNAILS=true
FEATURE_SEARCH=true
FEATURE_ANALYTICS=false

# ========================================================================
# 16. CLUSTERING ET SCALING
# ========================================================================

# Configuration clustering
CLUSTER_MODE=false
CLUSTER_INSTANCES=1
CLUSTER_REDIS_ADAPTER=true

# Load balancing
ENABLE_STICKY_SESSIONS=true
SESSION_AFFINITY=true

# Scaling
AUTO_SCALING=false
MIN_INSTANCES=1
MAX_INSTANCES=5
CPU_THRESHOLD=80
MEMORY_THRESHOLD=80

# ========================================================================
# 17. VARIABLES SPÉCIFIQUES PRODUCTION
# ========================================================================

# SSL/TLS (Production uniquement)
SSL_ENABLED=false
SSL_CERT_PATH=
SSL_KEY_PATH=
SSL_CA_PATH=

# Base URLs (Production)
API_BASE_URL=http://localhost:8003
FRONTEND_URL=http://localhost:3000
CDN_URL=

# Monitoring externe (Production)
EXTERNAL_MONITORING_URL=
MONITORING_API_KEY=
ERROR_REPORTING_URL=
ERROR_REPORTING_API_KEY=

# ========================================================================
# FIN DE CONFIGURATION
# ========================================================================