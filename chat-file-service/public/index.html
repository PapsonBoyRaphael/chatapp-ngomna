<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ”§ Testeur Socket.IO - CENADI Chat Service</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>ğŸ”§ Testeur Socket.IO - CENADI Chat Service</h1>
        <div class="connection-status" id="connectionStatus">ğŸ”´ DÃ©connectÃ©</div>
      </header>

      <div class="main-content">
        <!-- Section Authentification AMÃ‰LIORÃ‰E -->
        <div class="section auth-section">
          <h2>ğŸ” Authentification (Destinataire)</h2>
          <div class="form-group">
            <input
              type="text"
              id="userId"
              placeholder="ID Utilisateur (ex: 2)"
              value="2"
            />
            <input
              type="text"
              id="matricule"
              placeholder="Matricule (ex: 559296X)"
              value="559296X"
            />
            <input type="text" id="token" placeholder="Token JWT (optionnel)" />
            <button onclick="authenticate()" class="btn-primary">
              ğŸ”‘ S'authentifier comme DESTINATAIRE
            </button>
          </div>
          <div class="status" id="authStatus"></div>

          <!-- âœ… NOUVEAU : Informations du destinataire -->
          <div class="recipient-info-box">
            <h3>ğŸ“Š Informations du Destinataire</h3>
            <div id="recipientInfo" class="info-content">
              <p class="placeholder">
                Authentifiez-vous pour voir les informations
              </p>
            </div>
          </div>
        </div>

        <!-- Section Diagnostic NOUVEAU -->
        <div class="section diagnostic-section">
          <h2>ğŸ” Diagnostic de Livraison</h2>
          <div class="form-group">
            <button onclick="diagnoseDelivery()" class="btn-primary">
              ğŸ” Diagnostiquer ma Livraison
            </button>
            <button onclick="troubleshootDelivery()" class="btn-secondary">
              ğŸ”§ RÃ©soudre les ProblÃ¨mes
            </button>
            <button onclick="viewDeliveryStats()" class="btn-secondary">
              ğŸ“Š Statistiques de Livraison
            </button>
          </div>

          <!-- âœ… NOUVEAU : RÃ©sultats du diagnostic -->
          <div id="diagnosticResults" class="diagnostic-results hidden">
            <h3>ğŸ“‹ RÃ©sultats du Diagnostic</h3>
            <div id="diagnosticContent" class="diagnostic-content"></div>
          </div>
        </div>

        <!-- Section Tests de Base -->
        <div class="section test-section">
          <h2>ğŸ§ª Tests de Base</h2>
          <div class="button-grid">
            <button onclick="pingTest()" class="btn-secondary">
              ğŸ“ Test Ping
            </button>
            <button onclick="getOnlineUsers()" class="btn-secondary">
              ğŸ‘¥ Utilisateurs en ligne
            </button>
            <button onclick="disconnect()" class="btn-warning">
              ğŸ”Œ DÃ©connecter
            </button>
            <button onclick="reconnect()" class="btn-success">
              ğŸ”„ Reconnecter
            </button>
          </div>
        </div>

        <!-- Section Configuration du Testeur -->
        <div class="section config-section">
          <h2>âš™ï¸ Configuration du Testeur</h2>
          <div class="form-group">
            <label>
              <input type="checkbox" id="autoReceiptCheckbox" checked />
              âœ… AccusÃ© de rÃ©ception automatique
            </label>
            <label>
              <input type="checkbox" id="autoMarkDeliveredCheckbox" checked />
              ğŸ“¬ Marquer automatiquement comme livrÃ©
            </label>
            <label>
              <input type="checkbox" id="autoMarkReadCheckbox" />
              ğŸ“– Marquer automatiquement comme lu (aprÃ¨s 3s)
            </label>
            <label>
              <input type="checkbox" id="showNotificationsCheckbox" checked />
              ğŸ”” Afficher les notifications
            </label>
          </div>
        </div>

        <!-- Section Messages & Ã‰vÃ©nements ReÃ§us AMÃ‰LIORÃ‰E -->
        <div class="section messages-display-section">
          <h2>ğŸ“¨ Messages & Ã‰vÃ©nements ReÃ§us</h2>

          <!-- âœ… NOUVEAU : Statistiques de rÃ©ception -->
          <div class="reception-stats">
            <div class="stat-item">
              <span class="stat-label">Messages ReÃ§us:</span>
              <span class="stat-value" id="receivedCount">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Messages LivrÃ©s:</span>
              <span class="stat-value" id="deliveredCount">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Messages Lus:</span>
              <span class="stat-value" id="readCount">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Erreurs:</span>
              <span class="stat-value" id="errorCount">0</span>
            </div>
          </div>

          <div class="messages-container">
            <!-- Onglets pour filtrer les types de messages -->
            <div class="message-tabs">
              <button
                class="tab-btn active"
                onclick="switchMessageTab('all')"
                id="allTab"
              >
                ğŸ“‹ Tous
              </button>
              <button
                class="tab-btn"
                onclick="switchMessageTab('messages')"
                id="messagesTab"
              >
                ğŸ’¬ Messages
              </button>
              <button
                class="tab-btn"
                onclick="switchMessageTab('typing')"
                id="typingTab"
              >
                âŒ¨ï¸ Frappe
              </button>
              <button
                class="tab-btn"
                onclick="switchMessageTab('users')"
                id="usersTab"
              >
                ğŸ‘¥ Utilisateurs
              </button>
              <button
                class="tab-btn"
                onclick="switchMessageTab('errors')"
                id="errorsTab"
              >
                âŒ Erreurs
              </button>
            </div>

            <!-- Zone d'affichage des messages -->
            <div class="messages-display" id="messagesDisplay">
              <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Aucun message reÃ§u</p>
                <small>Les messages et Ã©vÃ©nements apparaÃ®tront ici</small>
              </div>
            </div>

            <!-- ContrÃ´les -->
            <div class="message-controls">
              <button onclick="clearMessages()" class="btn-clear">
                ğŸ—‘ï¸ Vider Messages
              </button>
              <button
                onclick="toggleAutoScroll()"
                class="btn-secondary"
                id="autoScrollBtn"
              >
                ğŸ“œ Auto-scroll: ON
              </button>
              <div class="message-stats">
                <span id="messageCount">0 messages</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Utilisateurs En Ligne -->
        <div class="section online-users-section">
          <h2>ğŸ‘¥ Utilisateurs En Ligne</h2>
          <div class="online-users-container">
            <div class="users-grid" id="onlineUsersGrid">
              <div class="empty-state">
                <i class="fas fa-users"></i>
                <p>Aucun utilisateur en ligne</p>
                <small>Les utilisateurs connectÃ©s apparaÃ®tront ici</small>
              </div>
            </div>
            <div class="users-stats">
              <span id="onlineCount">0 utilisateurs en ligne</span>
            </div>
          </div>
        </div>

        <!-- Section Indicateurs de Frappe -->
        <div class="section typing-indicators-section">
          <h2>âŒ¨ï¸ Indicateurs de Frappe</h2>
          <div class="typing-container">
            <div class="typing-list" id="typingList">
              <div class="empty-state">
                <i class="fas fa-keyboard"></i>
                <p>Personne n'Ã©crit actuellement</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Actions Rapides NOUVEAU -->
        <div class="section quick-actions-section">
          <h2>âš¡ Actions Rapides</h2>
          <div class="button-grid">
            <button onclick="replayAllMessages()" class="btn-warning">
              ğŸ”„ Rejouer Tous les Messages
            </button>
            <button onclick="exportMessages()" class="btn-secondary">
              ğŸ’¾ Exporter les Messages
            </button>
            <button onclick="testSimulatedDelay()" class="btn-secondary">
              â±ï¸ Tester DÃ©lai
            </button>
            <button onclick="simulateNetworkError()" class="btn-danger">
              âŒ Simuler Erreur RÃ©seau
            </button>
          </div>
        </div>
      </div>

      <!-- Logs en temps rÃ©el -->
      <div class="logs-section">
        <div class="logs-header">
          <h3>ğŸ“Š Logs en temps rÃ©el</h3>
          <button onclick="clearLogs()" class="btn-clear">ğŸ§¹ Vider</button>
          <button onclick="exportLogs()" class="btn-secondary">
            ğŸ’¾ Exporter
          </button>
        </div>
        <div class="logs-container" id="logsContainer"></div>
      </div>
    </div>

    <!-- âœ… MODAL DE NOTIFICATION NOUVEAU -->
    <div id="notificationModal" class="notification-modal hidden">
      <div class="notification-content">
        <div class="notification-header">
          <span id="notificationTitle">ğŸ”” Notification</span>
          <button onclick="closeNotification()" class="close-btn">âœ•</button>
        </div>
        <div class="notification-body" id="notificationBody"></div>
        <div class="notification-footer">
          <button onclick="closeNotification()" class="btn-secondary">
            OK
          </button>
        </div>
      </div>
    </div>

    <script src="app-recipient.js"></script>
  </body>
</html>
