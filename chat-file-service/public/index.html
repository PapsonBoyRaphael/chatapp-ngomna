<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ”§ Testeur Socket.IO - CENADI Chat Service</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>ğŸ”§ Testeur Socket.IO - CENADI Chat Service</h1>
        <div class="connection-status" id="connectionStatus">ğŸ”´ DÃ©connectÃ©</div>
      </header>

      <div class="main-content">
        <!-- Section Authentification -->
        <div class="section auth-section">
          <h2>ğŸ” Authentification</h2>
          <div class="form-group">
            <input
              type="text"
              id="userId"
              placeholder="ID Utilisateur (ex: 3)"
              value="3"
            />
            <input
              type="text"
              id="matricule"
              placeholder="Matricule (ex: 559296X)"
              value="559296X"
            />
            <input type="text" id="token" placeholder="Token JWT (optionnel)" />
            <!-- âœ… Ajout receiverId -->
            <input
              type="text"
              id="receiverIdAuth"
              placeholder="ID Destinataire (optionnel)"
              value=""
            />
            <!-- âœ… Ajout statut -->
            <select id="statusAuth">
              <option value="">-- Statut (optionnel) --</option>
              <option value="DELIVERED">DELIVERED</option>
              <option value="SENT">SENT</option>
              <option value="READ">READ</option>
            </select>
            <button onclick="authenticate()" class="btn-primary">
              ğŸ”‘ S'authentifier
            </button>
          </div>
          <div class="status" id="authStatus"></div>
        </div>

        <!-- Section Tests de Base -->
        <div class="section test-section">
          <h2>ğŸ§ª Tests de Base</h2>
          <div class="button-grid">
            <button onclick="pingTest()" class="btn-secondary">
              ğŸ“ Test Ping
            </button>
            <button onclick="getOnlineUsers()" class="btn-secondary">
              ğŸ‘¥ Utilisateurs en ligne
            </button>
            <button onclick="disconnect()" class="btn-warning">
              ğŸ”Œ DÃ©connecter
            </button>
            <button onclick="reconnect()" class="btn-success">
              ğŸ”„ Reconnecter
            </button>
          </div>
        </div>

        <!-- Section Messages -->
        <div class="section message-section">
          <h2>ğŸ’¬ Test Messages</h2>
          <div class="form-group">
            <input
              type="text"
              id="conversationId"
              placeholder="ID Conversation (24 caractÃ¨res hexa)"
              value="60f7b3b3b3b3b3b3b3b3b3b4"
            />
            <input
              type="text"
              id="receiverId"
              placeholder="ID Destinataire (REQUIS pour nouvelles conversations)"
              value="1"
            />
            <textarea
              id="messageContent"
              placeholder="Contenu du message..."
              rows="3"
            >
Message de test depuis le testeur Socket.IO ğŸš€</textarea
            >
            <select id="messageType">
              <option value="TEXT">TEXT</option>
              <option value="IMAGE">IMAGE</option>
              <option value="FILE">FILE</option>
            </select>
            <div class="button-grid">
              <button
                onclick="validateMessageData() && sendMessage()"
                class="btn-primary"
              >
                ğŸ“¤ Envoyer Message
              </button>
              <button onclick="generateTestIds()" class="btn-secondary">
                ğŸ”§ GÃ©nÃ©rer IDs Test
              </button>
            </div>
            <div class="form-help">
              <small>
                ğŸ’¡ Pour une nouvelle conversation privÃ©e, le receiverId est
                obligatoire
              </small>
            </div>
          </div>
        </div>

        <!-- Section Conversations -->
        <div class="section conversation-section">
          <h2>ğŸ—¨ï¸ Test Conversations</h2>
          <div class="button-grid">
            <button onclick="joinConversation()" class="btn-success">
              â• Rejoindre Conversation
            </button>
            <button onclick="leaveConversation()" class="btn-warning">
              â– Quitter Conversation
            </button>
            <button onclick="startTyping()" class="btn-secondary">
              âŒ¨ï¸ Commencer Ã  taper
            </button>
            <button onclick="stopTyping()" class="btn-secondary">
              â¹ï¸ ArrÃªter de taper
            </button>
          </div>
        </div>

        <!-- Section Tests AvancÃ©s -->
        <div class="section advanced-section">
          <h2>ğŸ”¬ Tests AvancÃ©s</h2>
          <div class="button-grid">
            <button onclick="testInvalidData()" class="btn-danger">
              âŒ Test DonnÃ©es Invalides
            </button>
            <button onclick="testLongMessage()" class="btn-secondary">
              ğŸ“ Test Message Long
            </button>
            <button onclick="testSpecialChars()" class="btn-secondary">
              ğŸ”¤ Test CaractÃ¨res SpÃ©ciaux
            </button>
            <button onclick="stressTest()" class="btn-warning">
              âš¡ Test de Charge
            </button>
          </div>
        </div>

        <!-- âœ… AJOUTER CETTE SECTION APRÃˆS LA SECTION CONVERSATIONS -->
        <div class="section message-status-section">
          <h2>ğŸ“Š Statuts de Messages</h2>
          <div class="form-group">
            <input
              type="text"
              id="messageIdStatus"
              placeholder="ID du Message (laisser vide pour utiliser le dernier envoyÃ©)"
              value=""
            />
            <div class="button-grid">
              <button onclick="getLastMessageId()" class="btn-info">
                ğŸ” RÃ©cupÃ©rer Dernier ID
              </button>
              <button onclick="markMessageDelivered()" class="btn-success">
                ğŸ“¬ Marquer LivrÃ©
              </button>
              <button onclick="markMessageRead()" class="btn-success">
                ğŸ“– Marquer Lu
              </button>
              <button onclick="markConversationRead()" class="btn-primary">
                ğŸ“š Marquer Conversation Lue
              </button>
              <button onclick="getMessageStatus()" class="btn-secondary">
                ğŸ“Š Obtenir Statut
              </button>
            </div>
            <div class="form-help">
              <small>
                ğŸ” Utilisez "RÃ©cupÃ©rer Dernier ID" pour auto-remplir avec le
                dernier message envoyÃ©
              </small>
              <br />
              <small>
                ğŸ“¬ LivrÃ© = Le message est arrivÃ© sur l'appareil du destinataire
              </small>
              <br />
              <small> ğŸ“– Lu = Le destinataire a ouvert et lu le message </small>
              <br />
              <small>
                ğŸ“š Conversation Lue = Tous les messages non lus de la
                conversation sont marquÃ©s comme lus
              </small>
            </div>
          </div>
        </div>

        <!-- Section Messages & Ã‰vÃ©nements ReÃ§us -->
        <div class="section messages-display-section">
          <h2>ğŸ“¨ Messages & Ã‰vÃ©nements ReÃ§us</h2>
          <div class="messages-container">
            <!-- Onglets pour filtrer les types de messages -->
            <div class="message-tabs">
              <button
                class="tab-btn active"
                onclick="switchMessageTab('all')"
                id="allTab"
              >
                ğŸ“‹ Tous
              </button>
              <button
                class="tab-btn"
                onclick="switchMessageTab('messages')"
                id="messagesTab"
              >
                ğŸ’¬ Messages
              </button>
              <button
                class="tab-btn"
                onclick="switchMessageTab('typing')"
                id="typingTab"
              >
                âŒ¨ï¸ Frappe
              </button>
              <button
                class="tab-btn"
                onclick="switchMessageTab('users')"
                id="usersTab"
              >
                ğŸ‘¥ Utilisateurs
              </button>
            </div>

            <!-- Zone d'affichage des messages -->
            <div class="messages-display" id="messagesDisplay">
              <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Aucun message reÃ§u</p>
                <small>Les messages et Ã©vÃ©nements apparaÃ®tront ici</small>
              </div>
            </div>

            <!-- ContrÃ´les -->
            <div class="message-controls">
              <button onclick="clearMessages()" class="btn-clear">
                ğŸ—‘ï¸ Vider Messages
              </button>
              <button
                onclick="toggleAutoScroll()"
                class="btn-secondary"
                id="autoScrollBtn"
              >
                ğŸ“œ Auto-scroll: ON
              </button>
              <div class="message-stats">
                <span id="messageCount">0 messages</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Utilisateurs En Ligne -->
        <div class="section online-users-section">
          <h2>ğŸ‘¥ Utilisateurs En Ligne</h2>
          <div class="online-users-container">
            <div class="users-grid" id="onlineUsersGrid">
              <div class="empty-state">
                <i class="fas fa-users"></i>
                <p>Aucun utilisateur en ligne</p>
                <small
                  >Authentifiez-vous pour voir les utilisateurs connectÃ©s</small
                >
              </div>
            </div>
            <div class="users-stats">
              <span id="onlineCount">0 utilisateurs en ligne</span>
            </div>
          </div>
        </div>

        <!-- Section Indicateurs de Frappe -->
        <div class="section typing-indicators-section">
          <h2>âŒ¨ï¸ Indicateurs de Frappe</h2>
          <div class="typing-container">
            <div class="typing-list" id="typingList">
              <div class="empty-state">
                <i class="fas fa-keyboard"></i>
                <p>Personne n'Ã©crit actuellement</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Upload de Fichier -->
        <div class="section file-upload-section">
          <h2>ğŸ“ Envoyer un Fichier</h2>
          <form id="fileUploadForm" enctype="multipart/form-data">
            <div class="form-group">
              <input type="file" id="fileInput" name="file" required />
              <input
                type="text"
                id="fileConversationId"
                placeholder="ID Conversation (optionnel)"
              />
              <button type="submit" class="btn-primary">
                â¬†ï¸ Envoyer Fichier
              </button>
            </div>
            <div class="status" id="fileUploadStatus"></div>
          </form>
        </div>

        <!-- Section Mes Fichiers -->
        <div class="section my-files-section">
          <h2>ğŸ“ Mes Fichiers</h2>
          <div class="button-grid">
            <button onclick="fetchMyFiles()" class="btn-secondary">
              ğŸ“ Mes Fichiers
            </button>
          </div>
          <div id="myFilesList"></div>
        </div>

        <!-- Section Groupes et Diffusion -->
        <div class="section group-section">
          <h2>ğŸ‘¥ Test Groupes & Diffusion</h2>
          <div class="form-group">
            <input
              type="text"
              id="groupId"
              placeholder="ID Groupe (ObjectId auto)"
            />
            <button onclick="generateGroupId()" class="btn-secondary">
              ğŸ”§ GÃ©nÃ©rer ID Groupe
            </button>
            <input
              type="text"
              id="broadcastId"
              placeholder="ID Liste de diffusion (ObjectId auto)"
            />
            <button onclick="generateBroadcastId()" class="btn-secondary">
              ğŸ”§ GÃ©nÃ©rer ID Diffusion
            </button>
            <input
              type="text"
              id="groupReceiverIds"
              placeholder="IDs utilisateurs (sÃ©parÃ©s par virgule)"
            />
            <textarea
              id="groupMessageContent"
              placeholder="Message pour le groupe..."
              rows="2"
            ></textarea>
            <textarea
              id="broadcastMessageContent"
              placeholder="Message pour la diffusion..."
              rows="2"
            ></textarea>
            <input
              type="text"
              id="groupName"
              placeholder="Nom du groupe (optionnel)"
            />
            <input
              type="text"
              id="broadcastName"
              placeholder="Nom de la diffusion (optionnel)"
            />
            <div class="button-grid">
              <button onclick="sendGroupMessage()" class="btn-success">
                ğŸ“¤ Envoyer au Groupe
              </button>
              <button onclick="sendBroadcastMessage()" class="btn-warning">
                ğŸ“¤ Envoyer Ã  la Diffusion
              </button>
              <button onclick="fetchGroupMessages()" class="btn-secondary">
                ğŸ“¥ RÃ©cupÃ©rer Messages Groupe
              </button>
              <button onclick="fetchBroadcastMessages()" class="btn-secondary">
                ğŸ“¥ RÃ©cupÃ©rer Messages Diffusion
              </button>
            </div>
          </div>
        </div>

        <!-- Section rÃ©ception complÃ¨te des messages -->
        <div class="section all-messages-section">
          <h2>ğŸ“¥ Tous les messages reÃ§us</h2>
          <div id="allMessagesList"></div>
        </div>
      </div>

      <!-- Logs en temps rÃ©el -->
      <div class="logs-section">
        <div class="logs-header">
          <h3>ğŸ“Š Logs en temps rÃ©el</h3>
          <button onclick="clearLogs()" class="btn-clear">ğŸ§¹ Vider</button>
        </div>
        <div class="logs-container" id="logsContainer"></div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>
